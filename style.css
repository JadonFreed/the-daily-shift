/* --- Color Palette & Fonts --- */
:root {
    --color-primary-dark: #0A0A0A; /* Black */
    --color-secondary-light: #EAEAEA; /* Silver */
    --color-accent-cyan: #00FFFF; /* Cyan */
    --color-error-red: #FF3131;
    --color-background-dark: #101827; /* Dark Navy */
    --color-feedback-green: #39FF14;
    --color-feedback-yellow: #FFD700;

    /* --- TEAM COLORS (Primary & Secondary) --- */
    --team-ANA-primary: #F47A38; --team-ANA-secondary: #B9975B; /* Orange, Gold */
    --team-ARI-primary: #8C2633; --team-ARI-secondary: #E2D6B5; /* Brick Red, Desert Sand */
    --team-BOS-primary: #FFB81C; --team-BOS-secondary: #000000; /* Gold, Black */
    --team-BUF-primary: #003087; --team-BUF-secondary: #FFB81C; /* Royal Blue, Gold */
    --team-CGY-primary: #C8102E; --team-CGY-secondary: #F1BE48; /* Red, Yellow Gold */
    --team-CAR-primary: #CC0000; --team-CAR-secondary: #000000; /* Red, Black */
    --team-CHI-primary: #CF0A2C; --team-CHI-secondary: #000000; /* Red, Black */
    --team-COL-primary: #6F263D; --team-COL-secondary: #236192; /* Burgundy, Blue */
    --team-CBJ-primary: #002654; --team-CBJ-secondary: #CE1126; /* Union Blue, Red */
    --team-DAL-primary: #006847; --team-DAL-secondary: #8F8F8C; /* Victory Green, Silver */
    --team-DET-primary: #CE1126; --team-DET-secondary: #FFFFFF; /* Red, White */
    --team-EDM-primary: #041E42; --team-EDM-secondary: #FF4C00; /* Navy Blue, Orange */
    --team-FLA-primary: #C8102E; --team-FLA-secondary: #041E42; /* Red, Navy */
    --team-LAK-primary: #111111; --team-LAK-secondary: #A2AAAD; /* Black, Silver */
    --team-MIN-primary: #154734; --team-MIN-secondary: #A6192E; /* Forest Green, Iron Range Red */
    --team-MTL-primary: #AF1E2D; --team-MTL-secondary: #192168; /* Red, Blue */
    --team-NSH-primary: #FFB81C; --team-NSH-secondary: #041E42; /* Gold, Navy Blue */
    --team-NJD-primary: #CE1126; --team-NJD-secondary: #000000; /* Red, Black */
    --team-NYI-primary: #00539B; --team-NYI-secondary: #F47D30; /* Royal Blue, Orange */
    --team-NYR-primary: #0038A8; --team-NYR-secondary: #CE1126; /* Blue, Red */
    --team-OTT-primary: #C52032; --team-OTT-secondary: #000000; /* Red, Black */
    --team-PHI-primary: #F74902; --team-PHI-secondary: #000000; /* Orange, Black */
    --team-PIT-primary: #FCB514; --team-PIT-secondary: #000000; /* Pittsburgh Gold, Black */
    --team-SJS-primary: #006D75; --team-SJS-secondary: #000000; /* Teal, Black */
    --team-SEA-primary: #001F5B; --team-SEA-secondary: #99D9D9; /* Deep Sea Blue, Ice Blue */
    --team-STL-primary: #002F87; --team-STL-secondary: #FCB514; /* Blue, Yellow */
    --team-TBL-primary: #002868; --team-TBL-secondary: #FFFFFF; /* Blue, White */
    --team-TOR-primary: #00205B; --team-TOR-secondary: #FFFFFF; /* Blue, White */
    --team-VAN-primary: #00205B; --team-VAN-secondary: #00843D; /* Blue, Green */
    --team-VGK-primary: #B4975A; --team-VGK-secondary: #333F42; /* Steel Grey, Gold */
    --team-WSH-primary: #C8102E; --team-WSH-secondary: #041E42; /* Red, Navy Blue */
    --team-WPG-primary: #041E42; --team-WPG-secondary: #AC162C; /* Navy Blue, Red */
    --team-UTA-primary: #5D2B7F; --team-UTA-secondary: #B5B5B7; /* Placeholder for Utah */
    --team-DEFAULT-primary: #555; --team-DEFAULT-secondary: #BBB;
}

/* --- Base & Layout --- */
body {
    background-color: var(--color-background-dark);
    color: var(--color-secondary-light);
    font-family: 'Space Mono', monospace;
    margin: 0;
    padding: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    overflow: hidden;
}

#app-container {
    width: 95%;
    max-width: 1600px;
    height: 90vh;
    border: 2px solid var(--color-accent-cyan);
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
    padding: 20px;
    background: var(--color-primary-dark);
    border-radius: 4px;
    display: flex;
    flex-direction: column;
}

/* --- Headers & Metrics --- */
h1, h2, h3, h4 {
    font-family: 'Electrolize', sans-serif;
    text-align: center;
    color: var(--color-accent-cyan);
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
    margin: 10px 0;
}
.data-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--color-secondary-light);
    padding-bottom: 15px;
    margin-bottom: 20px;
    flex-shrink: 0;
}
.metrics {
    font-size: 1.1em;
    display: flex;
    gap: 15px;
    color: var(--color-secondary-light);
}
.metric-item {
    padding: 5px 10px;
    border: 1px solid var(--color-accent-cyan);
    background: rgba(0, 255, 255, 0.1);
    font-size: 0.9em;
}
.accent-text {
    color: var(--color-accent-cyan);
    text-shadow: 0 0 5px var(--color-accent-cyan);
}

/* --- Screens --- */
.game-screen {
    display: none;
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px 0;
    position: relative; /* Needed for legend positioning */
}
.game-screen.active {
    display: flex;
    flex-direction: column;
}

/* --- Start Screen Specific --- */
.settings-panel {
    background: rgba(255, 255, 255, 0.05);
    padding: 20px;
    border: 1px solid var(--color-accent-cyan);
    max-width: 500px;
    margin: 10px auto; /* Reduced margin */
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.settings-panel label {
    color: var(--color-accent-cyan);
    font-size: 1em;
    margin-bottom: -10px;
}
#team-select, #favorite-team-select {
    padding: 10px;
    background: var(--color-primary-dark);
    color: var(--color-secondary-light);
    border: 1px solid var(--color-accent-cyan);
    font-family: 'Space Mono', monospace;
    font-size: 1em;
}
#team-select optgroup {
    font-family: 'Electrolize', sans-serif;
    font-style: normal;
    font-weight: bold;
    color: var(--color-accent-cyan);
    background: var(--color-background-dark);
}

.mode-options {
    display: flex;
    justify-content: space-around;
    background: rgba(0,0,0,0.2);
    padding: 10px;
    border: 1px dashed var(--color-accent-cyan);
}
.mode-options label {
    cursor: pointer;
    color: var(--color-secondary-light);
    font-size: 0.9em;
    margin-bottom: 0;
}
.mode-options input[type="radio"] {
    margin-right: 5px;
    accent-color: var(--color-accent-cyan);
}
.line-options {
    display: flex;
    justify-content: space-around;
}
.line-btn {
    padding: 8px 12px;
    background: var(--color-primary-dark);
    color: var(--color-accent-cyan);
    border: 1px solid var(--color-accent-cyan);
    cursor: pointer;
    transition: background 0.1s, color 0.1s;
    font-family: 'Space Mono', monospace;
}
.line-btn.active {
    background: var(--color-accent-cyan);
    color: var(--color-primary-dark);
    box-shadow: 0 0 8px var(--color-accent-cyan);
}

/* Division Mastery Section */
#division-mastery-section {
    border-color: var(--color-feedback-green);
    max-width: 500px; /* Match settings panel */
}
#division-mastery-section label {
    color: var(--color-feedback-green);
    text-align: center;
    margin-bottom: 10px;
}
#division-mastery-placeholder {
    font-style: italic;
    color: #aaa;
    text-align: center;
    font-size: 0.9em;
}
#division-quiz-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.division-quiz-btn {
    width: 100%;
    margin: 0;
    padding: 12px;
    font-size: 1em;
    background: var(--color-feedback-green);
    box-shadow: 0 0 10px var(--color-feedback-green);
}
.division-quiz-btn:hover {
    background: var(--color-secondary-light);
    box-shadow: 0 0 15px var(--color-secondary-light);
}


/* --- Quiz Screen Layout (Used for Quiz & Phase 3) --- */
#quiz-screen.active {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
.timer-bar-container {
    width: 100%;
    height: 25px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--color-secondary-light);
    margin-bottom: 15px;
    position: relative;
    border-radius: 2px;
    flex-shrink: 0;
}
#timer-bar {
    height: 100%;
    width: 100%;
    background: var(--color-accent-cyan);
    transition: width 1s linear;
    box-shadow: 0 0 10px var(--color-accent-cyan);
}
#timer-text {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: var(--color-primary-dark);
    font-weight: bold;
    font-family: 'Electrolize', sans-serif;
    text-shadow: 1px 1px 0 var(--color-secondary-light);
}
.line-builder-content {
    flex-grow: 1;
    overflow-y: auto;
    padding-bottom: 10px;
}

/* Line Unit & Slots */
.line-unit {
    border: 2px solid var(--color-accent-cyan);
    border-radius: 4px;
    padding: 10px 15px;
    margin-bottom: 15px;
    background: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
}
.line-unit h4 {
    color: var(--color-secondary-light);
    border-bottom: 1px solid var(--color-accent-cyan);
    padding-bottom: 5px;
    margin-bottom: 10px;
    font-size: 1.1em;
}
.line-slots {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
}
.line-slot {
    min-height: 120px;
    border: 1px dashed var(--color-secondary-light);
    background: rgba(0, 0, 0, 0.3);
    padding: 5px;
    text-align: center;
    transition: background 0.1s, border-color 0.1s, box-shadow 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
}
.line-slot.drag-over {
    background: rgba(0, 255, 255, 0.15);
    border-color: var(--color-accent-cyan);
    box-shadow: inset 0 0 10px var(--color-accent-cyan);
}
.line-slot .player-card {
    margin-top: 5px;
    width: 90%;
    height: 100px;
    cursor: pointer;
}
.line-slot-label {
    margin-top: auto;
    margin-bottom: 2px;
    color: #aaa;
    font-size: 0.9em;
}

/* --- MODIFIED: Player Pool (Dual Pool) --- */
.player-pool-area {
    flex-shrink: 0;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 10px;
    margin-top: 10px;
    background: rgba(0,0,0,0.3);
}
.dual-pool-container {
    display: flex;
    gap: 10px;
}
.pool-column {
    flex: 1; /* Each column takes 50% width */
    border: 1px solid var(--color-accent-cyan);
    padding: 5px;
    background: rgba(0,0,0,0.2);
}
.pool-header {
    text-align: center;
    color: var(--color-secondary-light);
    padding-bottom: 5px;
    margin-bottom: 5px;
    border: none;
    font-size: 1em;
}
.player-pool {
    display: flex;
    flex-wrap: nowrap;
    gap: 10px;
    padding: 10px;
    height: auto;
    min-height: 130px;
    overflow-x: auto;
    overflow-y: hidden;
    align-items: center;
}
/* --- END MODIFICATION --- */


/* --- PLAYER CARD (Jersey Style) --- */
.player-card {
    cursor: grab;
    width: 150px;
    height: 100px;
    border-radius: 8px;
    background: linear-gradient(135deg, var(--team-color-primary, var(--team-DEFAULT-primary)) 40%, var(--team-color-secondary, var(--team-DEFAULT-secondary)) 100%);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
    transition: transform 0.1s, box-shadow 0.2s;
    user-select: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    position: relative;
    overflow: hidden;
    padding: 5px;
    border: 2px solid rgba(255, 255, 255, 0.5);
    color: #FFF;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    flex-shrink: 0;
}
.player-card.dark-text {
    color: #111;
    text-shadow: 1px 1px 1px rgba(255,255,255,0.7);
}
.player-card:hover {
    transform: translateY(-4px) scale(1.03);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7), 0 0 10px var(--team-color-primary, var(--team-DEFAULT-primary));
}
.player-card.dragging {
    opacity: 0.5;
    transform: scale(0.9);
}

/* Card Content Styling */
.card-jersey-number {
    font-family: 'Electrolize', sans-serif;
    font-size: 2.8em;
    font-weight: bold;
    line-height: 1;
    margin-bottom: 0px;
}
.card-player-name {
    font-family: 'Space Mono', monospace;
    font-size: 0.9em;
    font-weight: bold;
    line-height: 1.1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 90%;
    margin: 0 auto;
}
.card-player-position {
    font-family: 'Electrolize', sans-serif;
    font-size: 1.1em;
    font-weight: bold;
    color: var(--color-accent-cyan);
    position: absolute;
    bottom: 8px;
    right: 12px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.9);
    display: none; /* Hide by default */
}
.dark-text .card-player-position {
    color: var(--color-primary-dark);
    text-shadow: none;
}

/* Logic for showing/hiding name/position */
.player-card.hide-name .card-player-name {
    display: none;
}
.player-card.hide-name .card-player-position {
    display: block;
}
.player-card.hide-name .card-jersey-number {
    font-size: 3.2em;
    margin-top: 5px;
    margin-bottom: 5px;
}
/* Force show position for phase 1 card display */
.phase-card-display .player-card .card-player-position {
    display: block;
}

/* --- NEW: Show position on all cards in the line builder screen --- */
#quiz-screen .player-card .card-player-position {
    display: block;
}


/* --- SCOUT SCHOOL Phase Styles --- */
.scout-phase-screen h2 { font-size: 1.5em; margin-bottom: 5px; }
.scout-phase-screen h3 { font-size: 1.2em; color: var(--color-secondary-light); margin-bottom: 10px; }
.phase-objective { text-align: center; font-style: italic; margin-bottom: 20px; color: #ccc; }
.phase-feedback { min-height: 30px; text-align: center; font-size: 1.2em; font-weight: bold; margin-top: 20px; }
.phase-feedback.correct { color: var(--color-feedback-green); }
.phase-feedback.incorrect { color: var(--color-error-red); }
.phase-progress { text-align: center; margin-top: 15px; font-size: 1.1em; color: #aaa; }

.position-legend {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 150px;
    padding: 10px;
    background: rgba(0,0,0,0.5);
    border: 1px solid var(--color-accent-cyan);
    border-radius: 4px;
}
.position-legend h4 {
    font-size: 1.1em;
    color: var(--color-secondary-light);
    margin: 0 0 10px 0;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--color-accent-cyan);
}
.position-legend ul { margin: 0; padding: 0; list-style: none; font-size: 0.9em; }
.position-legend li { margin-bottom: 5px; }
.position-legend li span { font-weight: bold; color: var(--color-accent-cyan); width: 20px; display: inline-block; }

/* Phase 1 & 2 Card/Choice Styling */
.phase-card-display { display: flex; justify-content: center; margin-bottom: 30px; }
.phase-card-display .player-card { transform: scale(1.1); cursor: default; }
.phase-card-display .player-card:hover { transform: scale(1.1); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6); }

.phase-choices { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 600px; margin: 0 auto; }
.choice-btn {
    padding: 15px; font-family: 'Electrolize', sans-serif; font-size: 1.1em;
    background: var(--color-primary-dark); color: var(--color-accent-cyan);
    border: 1px solid var(--color-accent-cyan); cursor: pointer; transition: background 0.1s, color 0.1s; text-align: center;
}
.choice-btn:hover:not(:disabled) { background: rgba(0, 255, 255, 0.2); }
.choice-btn.correct { background: var(--color-feedback-green); color: var(--color-primary-dark); border-color: var(--color-feedback-green); }
.choice-btn.incorrect { background: var(--color-error-red); color: var(--color-primary-dark); border-color: var(--color-error-red); }
.choice-btn:disabled { opacity: 0.7; cursor: default; }

/* Division Quiz Choices (4x2 grid) */
.division-quiz-choices {
    grid-template-columns: repeat(4, 1fr); /* 4 buttons per row */
    gap: 10px;
    max-width: 800px; /* Wider grid */
}
.division-quiz-choices .choice-btn {
    font-size: 1em; /* Slightly smaller text */
    padding: 12px 5px; /* Less padding */
}


/* Phase 3: Line Construction Feedback */
.line-slot.feedback-correct { border-style: solid; border-color: var(--color-feedback-green); box-shadow: 0 0 8px var(--color-feedback-green); animation: feedback-pulse 0.4s ease-out; }
.line-slot.feedback-warning { border-style: solid; border-color: var(--color-feedback-yellow); box-shadow: 0 0 8px var(--color-feedback-yellow); animation: feedback-pulse 0.4s ease-out; }
.line-slot.feedback-incorrect { border-style: solid; border-color: var(--color-error-red); box-shadow: 0 0 8px var(--color-error-red); animation: feedback-pulse 0.4s ease-out; }
@keyframes feedback-pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
.submit-btn {
    width: 40%; padding: 12px; font-size: 1.1em; margin: 15px auto 5px auto;
    background-color: #00aaff; box-shadow: 0 0 10px #00aaff;
}
.submit-btn:hover { background-color: var(--color-secondary-light); box-shadow: 0 0 15px var(--color-secondary-light); }

/* Phase Complete Screen */
#phase-complete-screen h2 { color: var(--color-feedback-green); font-size: 2em; }
#phase-complete-screen h2.failed { color: var(--color-error-red); } /* Style for failed title */
#team-mastery-badge strong { color: var(--color-accent-cyan); font-size: 1.5em; }

/* Buttons */
.action-btn {
    display: block; width: 60%; margin: 20px auto; padding: 15px;
    font-family: 'Electrolize', sans-serif; font-size: 1.2em;
    background: var(--color-accent-cyan); color: var(--color-primary-dark);
    border: none; cursor: pointer; box-shadow: 0 0 15px var(--color-accent-cyan);
    transition: background 0.15s, box-shadow 0.15s, transform 0.1s; border-radius: 4px;
}
.action-btn:hover {
    background: var(--color-secondary-light); box-shadow: 0 0 20px var(--color-secondary-light);
    color: var(--color-primary-dark); transform: translateY(-2px);
}

/* Debrief Screen */
.debrief-summary { text-align: center; font-size: 1.3em; margin: 20px 0; padding: 20px; border: 2px solid var(--color-accent-cyan); background: rgba(0, 255, 255, 0.05); }
.mistake-review-container { padding: 15px; border: 1px solid var(--color-secondary-light); background: var(--color-primary-dark); flex-grow: 1; overflow-y: auto; }
#mistake-review-list { margin-top: 10px; }
.mistake-item { padding: 10px; border-bottom: 1px dashed rgba(255, 255, 255, 0.1); background: rgba(255, 49, 49, 0.1); margin-bottom: 5px; }
.mistake-item strong { color: var(--color-error-red); }
.mistake-item .correct-answer { color: var(--color-accent-cyan); margin-left: 15px; }
.review-placeholder { text-align: center; font-style: italic; color: var(--color-accent-cyan); }
#debrief-screen.learning-mode #time-bonus-display { display: none; }